<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<title>Login</title>

<form id="login">
  <input name="username" placeholder="username" />
  <input name="password" type="password" placeholder="password" />
  <button>Sign in</button>
</form>

<script>
const API_BASE = 'http://127.0.0.1:8000'; // ถ้าเสิร์ฟหน้าเว็บจากพอร์ต 5500 ให้ชี้แบบนี้

document.getElementById('login').addEventListener('submit', async (e) => {
  e.preventDefault();

  const f = new FormData(e.target);
  const body = new URLSearchParams();
  body.set('username', f.get('username'));
  body.set('password', f.get('password'));
  body.set('grant_type', 'password'); // เพิ่มอันนี้

  const res  = await fetch(`${API_BASE}/auth/token`, {
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded'},
    body
  });

  const data = await res.json().catch(() => ({}));
  if (!res.ok) {
    alert(data.detail || 'login failed');
    return;
  }

  const { access_token } = data;
  localStorage.setItem('token', access_token);

  // ทดลองเรียก /auth/me
  const meRes = await fetch(`${API_BASE}/auth/me`, {
    headers: { Authorization: `Bearer ${access_token}` }
  });
  console.log('me =', await meRes.json());
});
</script>
</html>
